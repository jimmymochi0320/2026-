<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026æ–°å¹´åŒ—æµ·é“é“æ±è‡ªé§•éŠ</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="åŒ—æµ·é“è‡ªé§•">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJnameIjogIjIwMjYg5paw5bm05YyX5rW36YGT6Ieq6ae96YGKIiwKICAic2hvcnRfbmFtZSI6ICLljYXmtaTooYzoqIgiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2YxZjVmOSIsCiAgInRoZW1lX2NvbG9yIjogIiMwZjE3MmEiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsPHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCA1MTIgNTEyJz48cmVjdCB3aWR0aD0nNTEyJyBoZWlnaHQ9JzUxMicgZmlsbD0nIzBmMTcyYScvPjx0ZXh0IHg9JzUwJScgeT0nNTAlJyBmb250LXNpemU9JzMwMCcgZG9taW5hbnQtYmFzZWxpbmU9J21pZGRsZScgdGV4dC1hbmNob3I9J21pZGRsZScgZmlsbD0nIzhjYWZmZic+4p2EPC90ZXh0Pjwvc3ZnPiIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f1f5f9;
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 80px;
        }
        .sticky-nav {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-scroller {
            scrollbar-width: thin;
            scrollbar-color: #475569 transparent;
        }
        .nav-scroller::-webkit-scrollbar {
            height: 5px;
            display: block;
        }
        .nav-scroller::-webkit-scrollbar-track {
            background: transparent;
        }
        .nav-scroller::-webkit-scrollbar-thumb {
            background-color: #475569;
            border-radius: 10px;
        }
        .glass-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
        }
        .drive-stat-card {
            background: #f8fafc;
            border-radius: 12px;
            padding: 16px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            border: 1px solid #e2e8f0;
        }
        .daylight-bar {
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            overflow: hidden;
            position: relative;
            margin-top: 4px;
        }
        .daylight-fill {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%);
            position: absolute;
        }
        html {
            scroll-padding-top: 130px;
        }
        .timeline-dot {
            @apply absolute -left-[23px] w-4 h-4 rounded-full border-4 border-white bg-blue-500;
        }
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }
        .countdown-banner {
            animation: pulse-slow 3s infinite ease-in-out;
            transition: all 0.5s ease;
        }
        .custom-point-input {
            @apply w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all;
        }
        .custom-point-item {
            @apply flex items-center justify-between p-2 mt-2 bg-white border border-slate-100 rounded-lg shadow-sm animate-fade-in;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="text-slate-800 leading-relaxed">

    <!-- Header -->
    <header class="bg-slate-900 text-white pt-8 pb-4 px-6">
        <div class="container mx-auto max-w-2xl text-center md:text-left">
            <div class="flex items-center gap-3 justify-center md:justify-start">
                <i class="fas fa-snowflake text-blue-400 text-3xl animate-pulse"></i>
                <h1 class="text-2xl font-black tracking-tight">2026 æ–°å¹´åŒ—æµ·é“è‡ªé§•</h1>
            </div>
            <p class="text-[10px] text-slate-400 mt-2 uppercase tracking-[0.2em] opacity-80 text-center md:text-left">Geological & Nature Winter Expedition</p>
        </div>
    </header>

    <!-- Sticky Day Selector -->
    <nav class="sticky-nav shadow-xl">
        <div class="container mx-auto max-w-2xl p-2">
            <div class="overflow-x-auto whitespace-nowrap flex gap-2 nav-scroller px-2 py-2">
                <a href="#weather" class="px-4 py-2 bg-amber-500 text-slate-900 rounded-full text-xs font-black hover:bg-amber-400 shrink-0 transition shadow-lg border border-amber-600"><i class="fas fa-cloud-sun-rain mr-1"></i> å³æ™‚å¤©æ°£</a>
                <a href="#road-info" class="px-4 py-2 bg-emerald-600 text-white rounded-full text-xs font-black hover:bg-emerald-500 shrink-0 transition shadow-lg border border-emerald-700"><i class="fas fa-road mr-1"></i> å³æ™‚è·¯æ³</a>
                <a href="#day-1" class="px-4 py-2 bg-slate-800 text-white rounded-full text-xs font-black hover:bg-blue-600 shrink-0 transition shadow-inner border border-slate-700">D1</a>
                <a href="#day-2" class="px-4 py-2 bg-slate-800 text-white rounded-full text-xs font-black hover:bg-blue-600 shrink-0 transition shadow-inner border border-slate-700">D2</a>
                <a href="#day-3" class="px-4 py-2 bg-slate-800 text-white rounded-full text-xs font-black hover:bg-blue-600 shrink-0 transition shadow-inner border border-slate-700">D3</a>
                <a href="#day-4" class="px-4 py-2 bg-slate-800 text-white rounded-full text-xs font-black hover:bg-blue-600 shrink-0 transition shadow-inner border border-slate-700">D4</a>
                <a href="#day-5" class="px-4 py-2 bg-slate-800 text-white rounded-full text-xs font-black hover:bg-blue-600 shrink-0 transition shadow-inner border border-slate-700">D5</a>
                <a href="#day-6" class="px-4 py-2 bg-slate-800 text-white rounded-full text-xs font-black hover:bg-blue-600 shrink-0 transition shadow-inner border border-slate-700">D6</a>
                <a href="#day-7" class="px-4 py-2 bg-slate-800 text-white rounded-full text-xs font-black hover:bg-blue-600 shrink-0 transition shadow-inner border border-slate-700">D7</a>
                <a href="#day-8" class="px-4 py-2 bg-slate-800 text-white rounded-full text-xs font-black hover:bg-blue-600 shrink-0 transition shadow-inner border border-slate-700">D8</a>
                <a href="#day-9" class="px-4 py-2 bg-slate-800 text-white rounded-full text-xs font-black hover:bg-blue-600 shrink-0 transition shadow-inner border border-slate-700">D9</a>
                <a href="#day-10" class="px-4 py-2 bg-slate-800 text-white rounded-full text-xs font-black hover:bg-blue-600 shrink-0 transition shadow-inner border border-slate-700">D10</a>
                <a href="#day-11" class="px-4 py-2 bg-slate-800 text-white rounded-full text-xs font-black hover:bg-blue-600 shrink-0 transition shadow-inner border border-slate-700">D11</a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto max-w-2xl p-4 py-8 space-y-12">
        <div id="itinerary-container" class="space-y-12">
            <!-- ç”± JS å‹•æ…‹ç”Ÿæˆè¡Œç¨‹å¡ç‰‡ -->
        </div>
    </main>

    <!-- åº•éƒ¨å›ºå®šçš„æ—¥å‡º/æ—¥è½å€’æ•¸æ©«å¹… -->
    <div id="countdown-banner" class="fixed bottom-0 left-0 right-0 z-[110] bg-slate-900 text-white py-3 px-4 text-center shadow-[0_-4px_15px_rgba(0,0,0,0.3)] border-t border-slate-700 countdown-banner">
        <div class="container mx-auto flex items-center justify-center gap-3">
            <i id="countdown-icon" class="fas fa-clock text-sm text-blue-400"></i>
            <span id="countdown-label" class="text-[10px] font-bold tracking-widest uppercase">ç‹€æ…‹è¼‰å…¥ä¸­</span>
            <span id="countdown-timer" class="text-sm font-black font-mono tracking-tighter">00:00:00</span>
            <span id="countdown-tip" class="text-[9px] opacity-75 font-medium ml-1 hidden sm:inline">âš ï¸ ç•™æ„è·¯æ³</span>
        </div>
    </div>

    <!-- å³æ™‚è·¯æ³ (åŠ å¯¬ä¸”åŠ å¤§ç‰ˆ) -->
    <section id="road-info" class="container mx-auto max-w-5xl px-4 mb-12">
        <div class="glass-card rounded-3xl shadow-xl overflow-hidden border-t-8 border-emerald-600">
            <div class="px-6 py-4 border-b bg-white flex justify-between items-end">
                <div><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Real-time Traffic</p><h2 class="text-xl font-black text-slate-800">åŒ—æµ·é“é–‹ç™¼å±€å³æ™‚è·¯æ³</h2></div>
                <i class="fas fa-road text-slate-100 text-4xl mb-1"></i>
            </div>
            <div class="p-2 bg-slate-100">
                <div class="rounded-2xl overflow-hidden border border-slate-200 shadow-inner bg-white">
                    <!-- ç¶­æŒé«˜åº¦ 800px ç¢ºä¿æ“ä½œç©ºé–“ -->
                    <iframe width="100%" height="800" src="https://www.road-info-prvs.mlit.go.jp/roadinfo/pctw/" frameborder="0" class="w-full"></iframe>
                </div>
            </div>
            <div class="px-6 py-3 bg-white border-t text-center">
                <a href="https://www.road-info-prvs.mlit.go.jp/roadinfo/pctw/" target="_blank" class="text-[10px] font-bold text-emerald-600 hover:underline uppercase tracking-tighter">
                    <i class="fas fa-external-link-alt mr-1"></i> è‹¥ç„¡æ³•æ“ä½œè«‹é–‹å•Ÿå…¨è¢å¹•åŸå§‹ç¶²ç«™
                </a>
            </div>
        </div>
    </section>

    <!-- å¤©æ°£å€å¡Š -->
    <section id="weather" class="container mx-auto max-w-2xl px-4 mb-12">
        <div class="glass-card rounded-3xl shadow-xl overflow-hidden border-t-8 border-amber-500">
            <div class="px-6 py-4 border-b bg-white flex justify-between items-end">
                <div><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Weather & Map</p><h2 class="text-xl font-black text-slate-800">å³æ™‚æ°£è±¡èˆ‡é“æ±åœ°åœ–</h2></div>
                <i class="fas fa-cloud-sun text-slate-100 text-4xl mb-1"></i>
            </div>
            <div class="p-4 bg-slate-50 space-y-6">
                <div class="rounded-xl overflow-hidden shadow-sm border border-slate-200 bg-white">
                    <a class="weatherwidget-io" href="https://forecast7.com/zh-tw/43d06141d35/sapporo/" data-label_1="HOKKAIDO" data-label_2="æ—¥æœ¬åŒ—æµ·é“å³æ™‚æ°£è±¡" data-theme="pure" >HOKKAIDO æ—¥æœ¬åŒ—æµ·é“å³æ™‚æ°£è±¡</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='https://weatherwidget.io/js/widget.min.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','weatherwidget-io-js');</script>
                </div>
                <div id="windy-container" class="rounded-2xl overflow-hidden border border-slate-200 shadow-inner bg-white min-h-[450px]">
                    <div class="flex items-center justify-center h-[450px] text-slate-400 text-sm italic text-center px-4">
                        <div>
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>æ­£åœ¨è¼‰å…¥åœ°åœ–...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-slate-900 text-slate-500 text-center p-16 pb-32 text-xs font-bold font-black">
        <div class="flex justify-center gap-6 mb-4 text-slate-400 text-xl"><i class="fas fa-mountain"></i><i class="fas fa-snowflake"></i><i class="fas fa-car"></i></div>
        <p>Â© 2026 æ–°å¹´åŒ—æµ·é“è‡ªé§•</p>
        <p class="mt-4 uppercase tracking-widest opacity-30 text-[10px]">Cloud Sync & PWA Ready</p>
    </footer>

    <!-- Firebase & Logic Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'hokkaido-2026';

        let currentUser = null;

        const staticDays = [
            { id: 1, date: '2026.02.07 (å…­)', title: 'æŠµé”åŒ—æµ·é“ï¼šå–è»Šèˆ‡é›ªåœ°é©æ‡‰', icon: 'fa-plane-arrival', color: 'border-slate-600', sunrise: '06:44', sunset: '16:54', distance: '30 km', drive: '45 min', fee: 'å…è²»' },
            { id: 2, date: '2026.02.08 (æ—¥)', title: 'ç©¿è¶Šæ—¥é«˜å±±è„ˆï¼šå‰å¾€é˜¿å¯’æ¹–', icon: 'fa-mountain', color: 'border-blue-800', sunrise: '06:38', sunset: '16:48', distance: '220 km', drive: '3.5 hr', fee: 'Â¥4,600' },
            { id: 3, date: '2026.02.09 (ä¸€)', title: 'é˜¿å¯’æ¹–å®šé»éŠï¼šå†°ä¸Šå†’éšª', icon: 'fa-fish', color: 'border-indigo-600', sunrise: '06:37', sunset: '16:49', distance: '0 km', drive: '0 hr', fee: 'å…è²»', isRest: true },
            { id: 4, date: '2026.02.10 (äºŒ)', title: 'æ‘©å‘¨èˆ‡å±ˆæ–œè·¯ï¼šç ´ç«å±±å£å¥‡è¹Ÿ', icon: 'fa-volcano', color: 'border-blue-900', sunrise: '06:36', sunset: '16:50', distance: '65 km', drive: '1.5 hr', fee: 'å…è²»' },
            { id: 5, date: '2026.02.11 (ä¸‰)', title: 'æµå†°å¥‡ç·£ï¼šå‰å¾€é‡ä»˜åŠå³¶', icon: 'fa-icicles', color: 'border-cyan-600', sunrise: '06:32', sunset: '16:47', distance: '160 km', drive: '3.5 hr', fee: 'å…è²»' },
            { id: 6, date: '2026.02.12 (å››)', title: 'æ¿•åŸæ…¢éŠï¼šé¶´è¦‹èˆ‡çˆç«¯ç‡’', icon: 'fa-crow', color: 'border-emerald-700', sunrise: '06:32', sunset: '16:51', distance: '100 km', drive: '2.0 hr', fee: 'å…è²»' },
            { id: 7, date: '2026.02.13 (äº”)', title: 'å‹æ‰‹ä¸¼èˆ‡å¯¶çŸ³å†°ä¹‹æ—…', icon: 'fa-gem', color: 'border-purple-600', sunrise: '06:31', sunset: '16:53', distance: '130 km', drive: '2.5 hr', fee: 'å…è²»' },
            { id: 8, date: '2026.02.14 (å…­)', title: 'å¸¶å»£åˆ°ç™½è€ï¼šç¾å‘³å’Œç‰›å·¡ç¦®', icon: 'fa-hamburger', color: 'border-slate-700', sunrise: '06:33', sunset: '16:58', distance: '180 km', drive: '2.5 hr', fee: 'Â¥4,000' },
            { id: 9, date: '2026.02.15 (æ—¥)', title: 'æ„›åŠªæ°‘æ—èˆ‡å…¨æ—¥æœ€æ·±ç«å£æ¹–', icon: 'fa-archway', color: 'border-orange-500', sunrise: '06:35', sunset: '17:05', distance: '90 km', drive: '2.0 hr', fee: 'å…è²»' },
            { id: 10, date: '2026.02.16 (ä¸€)', title: 'æœ­å¹Œå¸‚å€ï¼šæœ€å¾Œæ¡è²·èˆ‡æ¢ç´¢', icon: 'fa-shopping-bag', color: 'border-slate-800', sunrise: '06:34', sunset: '17:07', distance: '0 km', drive: '0 hr', fee: 'å…è²»', isRest: true },
            { id: 11, date: '2026.02.17 (äºŒ)', title: 'è¸ä¸Šæ­¸é€”ï¼šæ»¿æ²¹é‚„è»Š âœˆï¸', icon: 'fa-plane-departure', color: 'border-slate-900', sunrise: '06:32', sunset: '17:08', distance: '50 km', drive: '1.0 hr', fee: 'Â¥1,300' }
        ];

        function renderItinerary(customPoints = []) {
            const container = document.getElementById('itinerary-container');
            container.innerHTML = '';
            staticDays.forEach(day => {
                const dayPoints = customPoints.filter(p => p.dayId === day.id);
                const section = document.createElement('section');
                section.id = `day-${day.id}`;
                section.className = `glass-card rounded-3xl shadow-xl overflow-hidden border-t-8 ${day.color}`;
                section.innerHTML = `
                    <div class="px-6 py-4 border-b bg-white flex justify-between items-end">
                        <div><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Day ${String(day.id).padStart(2,'0')} | ${day.date}</p><h2 class="text-xl font-black text-slate-800">${day.title}</h2></div>
                        <i class="fas ${day.icon} text-slate-100 text-4xl mb-1"></i>
                    </div>
                    <div class="p-6">
                        <div class="mb-6 bg-slate-50 p-3 rounded-xl border border-slate-100">
                            <div class="flex justify-between text-[10px] font-black text-slate-500 uppercase">
                                <span>ğŸŒ… ${day.sunrise}</span><span class="text-amber-600 italic">æ—¥å…‰æ™‚é–“</span><span>ğŸŒ‡ ${day.sunset}</span>
                            </div>
                            <div class="daylight-bar"><div class="daylight-fill" style="width: 45%;"></div></div>
                        </div>
                        ${!day.isRest ? `
                        <div class="drive-stat-card mb-6">
                            <div class="text-center border-r border-slate-200"><span class="text-[9px] text-slate-400 font-black uppercase">è·é›¢</span><p class="font-black text-lg">${day.distance}</p></div>
                            <div class="text-center border-r border-slate-200"><span class="text-[9px] text-slate-400 font-black uppercase">è¡Œè»Šæ™‚é–“</span><p class="font-black text-lg">${day.drive}</p></div>
                            <div class="text-center"><span class="text-[9px] text-slate-400 font-black uppercase">IC è²»ç”¨</span><p class="font-black text-lg text-emerald-600 italic">${day.fee}</p></div>
                        </div>` : `<div class="bg-indigo-50 text-indigo-800 py-4 rounded-2xl font-black text-sm mb-6 text-center">ğŸŒ² ä¼‘æ†©èˆ‡è‡ªç„¶æ¢ç´¢</div>`}
                        <div class="space-y-2 mb-6">
                            ${dayPoints.map(p => `
                            <div class="custom-point-item">
                                <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.name)}" target="_blank" class="flex items-center gap-2 text-xs font-bold text-blue-600 hover:underline"><i class="fas fa-map-marker-alt"></i> ${p.name}</a>
                                <button class="delete-btn text-slate-300 hover:text-red-500 p-1" data-id="${p.docId}"><i class="fas fa-times text-[10px]"></i></button>
                            </div>`).join('')}
                        </div>
                        <div class="mt-4 flex gap-2">
                            <input type="text" id="input-${day.id}" placeholder="æ–°å¢è‡ªå®šç¾©åœ°é»..." class="custom-point-input">
                            <button class="add-point-btn bg-slate-800 text-white px-3 py-2 rounded-lg text-xs font-black hover:bg-blue-600 transition-all" data-day="${day.id}"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>`;
                container.appendChild(section);
            });
            
            document.querySelectorAll('.add-point-btn').forEach(btn => {
                btn.onclick = async () => {
                    const dayId = parseInt(btn.dataset.day), input = document.getElementById(`input-${dayId}`), name = input.value.trim();
                    if (name && currentUser) { 
                        await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'locations'), { 
                            dayId, name, createdAt: Date.now() 
                        }); 
                        input.value = ''; 
                    }
                };
            });
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.onclick = async () => { 
                    if (currentUser) {
                        await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'locations', btn.dataset.id)); 
                    }
                };
            });
        }

        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (e) {
                console.error("Auth init failed:", e);
            }
        };

        const init = () => {
            onAuthStateChanged(auth, user => {
                currentUser = user;
                if (user) {
                    const q = collection(db, 'artifacts', appId, 'public', 'data', 'locations');
                    onSnapshot(q, snap => {
                        renderItinerary(snap.docs.map(d => ({ ...d.data(), docId: d.id })));
                    }, err => {
                        console.error("Firestore listener failed:", err);
                    });
                }
            });
            initAuth();

            const updateCountdown = () => {
                const timerEl = document.getElementById('countdown-timer'), labelEl = document.getElementById('countdown-label'), iconEl = document.getElementById('countdown-icon'), banner = document.getElementById('countdown-banner'), now = new Date();
                const sunrise = new Date(); sunrise.setHours(6, 40, 0);
                const sunset = new Date(); sunset.setHours(16, 50, 0);
                const startSunset = new Date(); startSunset.setHours(14, 0, 0); 
                const startSunrise = new Date(sunrise.getTime() - (2 * 3600000));
                
                const fmt = ms => { 
                    const h = Math.floor(ms/3600000), m = Math.floor((ms%3600000)/60000), s = Math.floor((ms%60000)/1000); 
                    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; 
                };

                if (now >= startSunset && now < sunset) {
                    banner.className = "fixed bottom-0 left-0 right-0 z-[110] bg-gradient-to-r from-orange-600 to-rose-700 text-white py-3 px-4 text-center shadow-lg border-t border-orange-400 countdown-banner";
                    labelEl.innerText = "æ—¥è½å€’æ•¸"; timerEl.innerText = fmt(sunset - now); iconEl.className = "fas fa-sun text-sm animate-spin-slow text-yellow-300";
                } else if (now >= startSunrise && now < sunrise) {
                    banner.className = "fixed bottom-0 left-0 right-0 z-[110] bg-gradient-to-r from-blue-700 to-indigo-900 text-white py-3 px-4 text-center shadow-lg border-t border-blue-400 countdown-banner";
                    labelEl.innerText = "æ—¥å‡ºå€’æ•¸"; timerEl.innerText = fmt(sunrise - now); iconEl.className = "fas fa-moon text-sm animate-pulse text-blue-200";
                } else {
                    banner.className = "fixed bottom-0 left-0 right-0 z-[110] bg-slate-900 text-white py-3 px-4 text-center shadow-lg border-t border-slate-700 countdown-banner";
                    labelEl.innerText = (now >= sunrise && now < startSunset) ? "æ—¥å…‰æ´»å‹•ä¸­" : "å¤œæ™šè¡Œè»Šæ³¨æ„"; 
                    timerEl.innerText = (now >= sunrise && now < startSunset) ? "ENJOY DAYLIGHT" : "REST MODE"; 
                    iconEl.className = "fas fa-car text-sm text-blue-400";
                }
            };
            setInterval(updateCountdown, 1000); updateCountdown();
        };

        const loadWindy = (lat, lon) => {
            const url = `https://embed.windy.com/embed2.html?lat=${lat}&lon=${lon}&zoom=8&level=surface&overlay=temp&menu=&message=&marker=true&calendar=&pressure=&type=map&location=coordinates&detail=true&metricWind=default&metricTemp=default&radarRange=-1`;
            document.getElementById('windy-container').innerHTML = `<iframe width="100%" height="450" src="${url}" frameborder="0"></iframe>`;
        };
        if (navigator.geolocation) navigator.geolocation.getCurrentPosition(p => loadWindy(p.coords.latitude, p.coords.longitude), () => loadWindy(43.5, 142.5), {timeout: 5000});
        else loadWindy(43.5, 142.5);

        init();
    </script>
</body>
</html>
